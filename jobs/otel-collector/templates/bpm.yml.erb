<%
    process = {
      'name' => 'otel-collector',
      'executable' => '/var/vcap/packages/otel-collector/otel-collector',
      'args' => ['--config', '/var/vcap/jobs/otel-collector/config/config.yml']
    }

    memory_mib = p('limits.memory_mib')
    process['limits'] = { 'memory' => "#{memory_mib}MiB" }
    process['env'] = { 'GOMEMLIMIT' => "#{(memory_mib.to_i * 0.80).floor}MiB" }

    bpm = { 'processes' => [process] }
%>

<%= YAML.dump(bpm) %>
